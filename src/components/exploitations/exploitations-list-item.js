import Link from 'next/link.js'

import ListItem from '@/components/ui/ListItem/index.js'
import {formatDateRange} from '@/lib/format-date.js'
import {usageIcons} from '@/lib/points-prelevement.js'
import {getPreleveurTitle} from '@/lib/preleveurs.js'

const severityMap = {
  EN_ACTIVITE: 'info',
  TERMINEE: 'success',
  ABANDONNEE: 'error',
  NON_ACTIVITE: 'warning'
}

const ExploitationsListItem = ({exploitation, preleveur, index, hidePreleveur = false}) => {
  const metas = []

  if (!hidePreleveur) {
    metas.push({content: getPreleveurTitle(preleveur), iconId: 'fr-icon-user-line'})
  }

  metas.push({
    content: formatDateRange(exploitation.startDate, exploitation.endDate),
    iconId: 'fr-icon-calendar-2-line'
  })

  console.log('ExploitationsListItem', {exploitation, preleveur, metas})

  return (
    <Link href={`/exploitations/${exploitation.id}`}>
      <ListItem
        border
        background={index % 2 === 0 ? 'primary' : 'secondary'}
        tags={[{label: exploitation.status, severity: severityMap[exploitation.status], hasIcon: false}]}
        title={`${exploitation.pointPrelevement.name}`}
        rightIcons={exploitation.usages.map(usage => (
          {label: usage, icon: usageIcons[usage]}
        ))}
        metas={metas}
      />
    </Link>

  )
}

export default ExploitationsListItem
