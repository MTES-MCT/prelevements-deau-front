import dynamic from 'next/dynamic'
import {notFound} from 'next/navigation'

import {getExploitation, getPointsPrelevement, getPreleveurs} from '@/app/api/points-prelevement.js'
import ExploitationEditionForm from '@/components/form/exploitation-edition-form.js'
import {StartDsfrOnHydration} from '@/dsfr-bootstrap/index.js'

const DynamicBreadcrumb = dynamic(
  () => import('@codegouvfr/react-dsfr/Breadcrumb')
)

const Page = async ({params}) => {
  const {id} = await params
  const exploitation = await getExploitation(id)

  if (!exploitation) {
    notFound()
  }

  const points = await getPointsPrelevement()
  const preleveurs = await getPreleveurs()

  const orderedPoints = points.sort((a, b) => {
    if (a.nom < b.nom) {
      return -1
    }

    if (a.nom > b.nom) {
      return 1
    }

    return 0
  })

  return (
    <div>
      <StartDsfrOnHydration />
      <div className='p-5'>
        <DynamicBreadcrumb
          currentPageLabel='Ã‰dition'
          homeLinkProps={{
            href: '/'
          }}
          segments={[]}
        />
      </div>
      <ExploitationEditionForm
        exploitation={exploitation}
        points={orderedPoints}
        preleveurs={preleveurs}
      />
    </div>
  )
}

export default Page
